angular
    .module('CavernUs')
    .component('mineShowPage', {
        templateUrl: '<%= asset_path("components/mineShowPage/mineShowPage") %>',
        controller: MineShowPageController
    });

MineShowPageController.$inject = ['$http', '$stateParams', 'minesService'];

function MineShowPageController($http, $stateParams, minesService) {
    var vm = this;

    vm.message = "Let's rock!";
    vm.mines = [];
    vm.users = [];
    vm.posts = [];
    vm.mine = [];

    vm.saveMine = saveMine;

    minesService.getMine($stateParams.mineId).then(function(resp) {
        vm.mine = resp.data;
    });

    function saveMine() {
        minesService.updateMine(vm.mine).then(function(resp) {
            if(resp.status == 200) {
                $state.go(mineShow, { id: resp.data.id })
            } else {
                alert('There was an error while editing this mine')
            }
        });
    }

    $http.get('/api/mines').then(function(resp) {
        vm.mines = resp.data;
    });
    $http.get('/api/users').then(function(resp) {
        vm.users = resp.data;
    });
    $http.get('/api/posts').then(function(resp) {
        vm.posts = resp.data;
    });
//    $http.get('/api/mines/' + $stateParams.mineId).then(function(resp) {
//        vm.mine = resp.data;
//    });

}