angular
    .module('CavernUs')
    .component('mineShowPage', {
        templateUrl: '<%= asset_path("components/mineShowPage/mineShowPage") %>',
        controller: MineShowPageController
    });

MineShowPageController.$inject = ['$http', '$state', '$stateParams', 'minesService', 'postsService', 'tripsService'];

function MineShowPageController($http, $state, $stateParams, minesService, postsService, tripsService) {
    var vm = this;

    vm.message = "Let's rock!";
    vm.mines = [];
    vm.users = [];
    vm.posts = [];
    vm.mine = {};
    vm.newPost = {
        title: '',
        content: '',
        mine_id: $stateParams.mineId
    };
    vm.newTrip = {
        date: '',
        description: '',
        mine_id: $stateParams.mineId
    };

    vm.saveMine = saveMine;
    vm.saveNewPost = saveNewPost;
    vm.saveNewTrip = saveNewTrip;

    minesService.getMine($stateParams.mineId).then(function(resp) {
        vm.mine = resp.data;
    });

    function saveMine() {
        minesService.updateMine(vm.mine).then(function(resp) {
            if(resp.status == 200) {
                console.log(resp)
//                $state.reload();
                //USE WHEN ADDING A NEW MINE
//                vm.mines.push(vm.newMine)
            } else {
                alert('There was an error while editing this mine')
            }
        });
    }

    function saveNewPost() {
        postsService.newPost(vm.newPost).then(function(resp) {
            console.log(vm.newPost);
            if(resp.status == 201) {
                console.log(resp)
//                console.log(vm.mine.current_user);
//                vm.newPost.user_id = vm.mine.current_user;
                //This, now vm.mine.posts.push works, look into it later: $atate.reload breaks modal fade, need to figure out a fix
                vm.mines.push(vm.newPost)
                console.log(vm.newPost);
                vm.newPost = {
                    title: '',
                    content: '',
                    mine_id: $stateParams.mineId
                };
//                $state.reload();
            } else {
                alert('There was an error while creating this post')
            }
        });
    }

    function saveNewTrip() {
        tripsService.newTrip(vm.newTrip).then(function(resp) {
            console.log(vm.newTrip);
            if(resp.status == 201) {
                console.log(resp)
//                $state.reload();
                //This, now vm.mine.posts.push works, look into it later
                vm.mines.push(vm.newTrip)
                vm.newTrip ={
                    date: '',
                    description: '',
                    mine_id: $stateParams.mineId
                };
            } else {
                alert('There was an error while creating this trip')
            }
        });
    }

    function addMemberToTrip



//    $http.get('/api/mines').then(function(resp) {
//        vm.mines = resp.data;
//    });
//    $http.get('/api/users').then(function(resp) {
//        vm.users = resp.data;
//    });
//    $http.get('/api/posts').then(function(resp) {
//        vm.posts = resp.data;
//    });


}